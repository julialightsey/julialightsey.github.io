<html>
  <head>
    <meta name="generator" content="HTML Tidy for HTML5 (experimental) for Windows https://github.com/w3c/tidy-html5/tree/c63cc39" />
    <title>[th&#601;_her&#601;tik]</title>
    <link rel="shortcut icon" href=".\source\image\chamomile.ico" />
    <link rel="stylesheet" type="text/css" href=".\source\common.css" />
  </head>
  <body>
    <table width="100%" style="border-collapse: collapse;">
      <tr>
        <td colspan="2" style="padding-left:25px; padding-right:25px;">
          <iframe src="./header.html" width="100%" height="350" scrolling="no" seamless="" frameborder="0"></iframe>
        </td>
      </tr>
    </table>
    <table width="100%" style="border-collapse: collapse;">
      <tr>
        <td colspan="2" style="padding-left:25px; padding-right:25px;">
          <table class="content" width="98%" style="border-collapse: collapse;">
            <tr class="menu">
              <td colspan="2" style="padding-left:25px; padding-right:25px;">
                <iframe src="./menu__home.html" width="100%" height="55" scrolling="no" seamless="" frameborder="0"></iframe>
              </td>
            </tr>
            <tr class="menu">
              <td colspan="2" style="padding-left:25px; padding-right:25px;">
                <iframe src="./menu__presentation.html" width="100%" height="150" scrolling="no" seamless="" frameborder="0"></iframe>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="100%" style="border-collapse: collapse;">
      <tr>
        <td colspan="2" style="padding-left:25px; padding-right:25px;">
          <!--  -->
          <!-- begin content table -->
          <table class="content">
            <tr>
              <td>
              <div><span style="font-family: Courier New; font-size: 10pt;">
<span style="color: green; font-style: italic; ">/*
<br/>&nbsp;&nbsp;All&nbsp;content&nbsp;is&nbsp;licensed&nbsp;as&nbsp;[chamomile]&nbsp;(http://www.KELightsey.com/license.html)&nbsp;and&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;copyright&nbsp;Katherine&nbsp;Elizabeth&nbsp;Lightsey,&nbsp;1959-2014&nbsp;(aka;&nbsp;my&nbsp;life),&nbsp;all&nbsp;rights&nbsp;reserved,
<br/>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;as&nbsp;open&nbsp;source&nbsp;under&nbsp;the&nbsp;GNU&nbsp;Affero&nbsp;GPL&nbsp;(http://www.gnu.org/licenses/agpl-3.0.html).
<br/>&nbsp;&nbsp;---------------------------------------------
<br/>
<br/>&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;--&nbsp;&nbsp;description
<br/>&nbsp;&nbsp;---------------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;SQL&nbsp;Server&nbsp;Exam&nbsp;70-461&nbsp;-&nbsp;Work&nbsp;with&nbsp;data&nbsp;(27%)...Implement&nbsp;aggregate&nbsp;queries...&nbsp;New&nbsp;analytic&nbsp;functions&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;SQL&nbsp;Server&nbsp;2012&nbsp;supports&nbsp;the&nbsp;following&nbsp;analytic&nbsp;functions.&nbsp;Analytic&nbsp;functions&nbsp;compute&nbsp;an&nbsp;aggregate&nbsp;value&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;based&nbsp;on&nbsp;a&nbsp;group&nbsp;of&nbsp;rows.&nbsp;However,&nbsp;unlike&nbsp;aggregate&nbsp;functions,&nbsp;they&nbsp;can&nbsp;return&nbsp;multiple&nbsp;rows&nbsp;for&nbsp;each&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group.&nbsp;You&nbsp;can&nbsp;use&nbsp;analytic&nbsp;functions&nbsp;to&nbsp;compute&nbsp;moving&nbsp;averages,&nbsp;running&nbsp;totals,&nbsp;percentages&nbsp;or&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top-N&nbsp;results&nbsp;within&nbsp;a&nbsp;group.&nbsp;&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUME_DIST&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculates&nbsp;the&nbsp;cumulative&nbsp;distribution&nbsp;of&nbsp;a&nbsp;value&nbsp;in&nbsp;a&nbsp;group&nbsp;of&nbsp;values&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;That&nbsp;is,&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUME_DIST&nbsp;computes&nbsp;the&nbsp;relative&nbsp;position&nbsp;of&nbsp;a&nbsp;specified&nbsp;value&nbsp;in&nbsp;a&nbsp;group&nbsp;of&nbsp;values.&nbsp;For&nbsp;a&nbsp;row&nbsp;r,&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assuming&nbsp;ascending&nbsp;ordering,&nbsp;the&nbsp;CUME_DIST&nbsp;of&nbsp;r&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;with&nbsp;values&nbsp;lower&nbsp;than&nbsp;or&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equal&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;r,&nbsp;divided&nbsp;by&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;evaluated&nbsp;in&nbsp;the&nbsp;partition&nbsp;or&nbsp;query&nbsp;result&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set.&nbsp;CUME_DIST&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;PERCENT_RANK&nbsp;function.&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUME_DIST()&nbsp;=&nbsp;&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUME_DIST()&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;partition_by_clause&nbsp;]&nbsp;order_by_clause&nbsp;)&nbsp;&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERCENT_RANK&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculates&nbsp;the&nbsp;relative&nbsp;rank&nbsp;of&nbsp;a&nbsp;row&nbsp;within&nbsp;a&nbsp;group&nbsp;of&nbsp;rows&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;Use&nbsp;PERCENT_RANK&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;evaluate&nbsp;the&nbsp;relative&nbsp;standing&nbsp;of&nbsp;a&nbsp;value&nbsp;within&nbsp;a&nbsp;query&nbsp;result&nbsp;set&nbsp;or&nbsp;partition.&nbsp;PERCENT_RANK&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;CUME_DIST&nbsp;function.&nbsp;this&nbsp;represents&nbsp;the&nbsp;percentage&nbsp;of&nbsp;values&nbsp;less&nbsp;than&nbsp;the&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;value&nbsp;in&nbsp;the&nbsp;group,&nbsp;excluding&nbsp;the&nbsp;highest&nbsp;value.&nbsp;Percent_Rank()&nbsp;for&nbsp;the&nbsp;highest&nbsp;value&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;a&nbsp;group&nbsp;will&nbsp;always&nbsp;be&nbsp;1.&nbsp;&nbsp;this&nbsp;gives&nbsp;the&nbsp;percentage&nbsp;of&nbsp;values&nbsp;less&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;value&nbsp;in&nbsp;the&nbsp;group.&nbsp;This&nbsp;is&nbsp;called&nbsp;the&nbsp;cumulative&nbsp;distribution.&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERCENT_RANK()&nbsp;=&nbsp;(RANK()&nbsp;–&nbsp;1)&nbsp;/&nbsp;(Total&nbsp;no&nbsp;of&nbsp;Rows&nbsp;–&nbsp;1)&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERCENT_RANK()&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;partition_by_clause&nbsp;]&nbsp;order_by_clause&nbsp;)&nbsp;
<br/>
<br/>&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;--&nbsp;&nbsp;notes
<br/>&nbsp;&nbsp;---------------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;presentation&nbsp;is&nbsp;designed&nbsp;to&nbsp;be&nbsp;run&nbsp;incrementally&nbsp;a&nbsp;code&nbsp;block&nbsp;at&nbsp;a&nbsp;time.&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;blocks&nbsp;are&nbsp;delineated&nbsp;as:
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;code&nbsp;block&nbsp;begin
<br/>&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<run&nbsp;code&nbsp;here>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;code&nbsp;block&nbsp;end
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;
<br/>&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;--&nbsp;references
<br/>&nbsp;&nbsp;---------------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;Analytic&nbsp;Functions&nbsp;(Transact-SQL)&nbsp;-&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://msdn.microsoft.com/en-us/library/hh213234.aspx
<br/>&nbsp;&nbsp;&nbsp;&nbsp;SQL&nbsp;SERVER&nbsp;–&nbsp;2012&nbsp;–&nbsp;Summary&nbsp;of&nbsp;All&nbsp;the&nbsp;Analytic&nbsp;Functions&nbsp;-&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://blog.sqlauthority.com/2011/11/23/sql-server-2012-summary-of-all-the-analytic-functions-msdn-and-sqlauthority/
<br/>&nbsp;&nbsp;&nbsp;&nbsp;Introduction&nbsp;to&nbsp;LEAD&nbsp;and&nbsp;LAG&nbsp;–&nbsp;Analytic&nbsp;Functions&nbsp;Introduced&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012&nbsp;-&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://blog.sqlauthority.com/2011/11/15/sql-server-introduction-to-lead-and-lag-analytic-functions-introduced-in-sql-server-2012/
<br/>&nbsp;&nbsp;&nbsp;&nbsp;Introduction&nbsp;to&nbsp;CUME_DIST&nbsp;–&nbsp;Analytic&nbsp;Functions&nbsp;Introduced&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012&nbsp;-&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://blog.sqlauthority.com/2011/11/08/sql-server-introduction-to-cume_dist-analytic-functions-introduced-in-sql-server-2012/
<br/>&nbsp;&nbsp;&nbsp;&nbsp;Introduction&nbsp;to&nbsp;PERCENTILE_DISC()&nbsp;–&nbsp;Analytic&nbsp;Functions&nbsp;Introduced&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012&nbsp;-&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://blog.sqlauthority.com/2011/11/22/sql-server-introduction-to-percentile_disc-analytic-functions-introduced-in-sql-server-2012/
<br/>&nbsp;&nbsp;&nbsp;&nbsp;SQL&nbsp;SERVER&nbsp;–&nbsp;2012&nbsp;–&nbsp;Summary&nbsp;of&nbsp;All&nbsp;the&nbsp;Analytic&nbsp;Functions&nbsp;–&nbsp;MSDN&nbsp;and&nbsp;SQLAuthority&nbsp;-&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.codeproject.com/Articles/290251/SQL-SERVER-Summary-of-All-the-Analytic-Functi
<br/>&nbsp;&nbsp;&nbsp;&nbsp;Percent_Rank&nbsp;and&nbsp;Cume_Dist&nbsp;functions&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012:&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.mssqltips.com/sqlservertip/2644/[percent_rank]-and-[cumulative_distribution]-functions-in-sql-server-2012/&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;Clause&nbsp;(Transact-SQL):&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://technet.microsoft.com/en-us/library/ms189461.aspx
<br/>*/</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: blue; ">use</span>&nbsp;<span style="color: maroon; ">[chamomile]</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">object_id</span><span style="color: maroon; ">(</span><span style="color: red; ">N'tempdb..##analytic_functions_01'</span><span style="color: silver; ">,</span>&nbsp;<span style="color: red; ">N'U'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">not</span>&nbsp;<span style="color: blue; ">null</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">drop</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##analytic_functions_01</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">create</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##analytic_functions_01</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">[id]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[int]</span>&nbsp;<span style="color: blue; ">identity</span><span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[number]</span>&nbsp;<span style="color: black; font-style: italic; ">[int]</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[name]</span>&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[nvarchar]</span><span style="color: maroon; ">(</span><span style="color: black; ">25</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##analytic_functions_01</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[number]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[name]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span><span style="color: red; ">N'one'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">2</span><span style="color: silver; ">,</span><span style="color: red; ">N'two'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: silver; ">,</span><span style="color: red; ">N'three'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">4</span><span style="color: silver; ">,</span><span style="color: red; ">N'four'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span><span style="color: red; ">N'five'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">6</span><span style="color: silver; ">,</span><span style="color: red; ">N'six'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">7</span><span style="color: silver; ">,</span><span style="color: red; ">N'seven'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">8</span><span style="color: silver; ">,</span><span style="color: red; ">N'eight'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">9</span><span style="color: silver; ">,</span><span style="color: red; ">N'nine'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">10</span><span style="color: silver; ">,</span><span style="color: red; ">N'ten'</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##analytic_functions_01</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[number]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[name]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: silver; ">,</span><span style="color: red; ">N'three'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: silver; ">,</span><span style="color: red; ">N'three'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: silver; ">,</span><span style="color: red; ">N'three'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: silver; ">,</span><span style="color: red; ">N'three'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">7</span><span style="color: silver; ">,</span><span style="color: red; ">N'seven'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">7</span><span style="color: silver; ">,</span><span style="color: red; ">N'seven'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">7</span><span style="color: silver; ">,</span><span style="color: red; ">N'seven'</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;compare&nbsp;cume_dist()&nbsp;and&nbsp;percent_rank()</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[number]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[name]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">cast</span><span style="color: maroon; ">(</span><span style="color: #FF0080; font-weight: bold; ">cume_dist</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[number]</span><span style="color: maroon; ">)</span><span style="color: blue; ">as</span>&nbsp;<span style="color: black; font-style: italic; ">decimal</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">2</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[cumulative_distribution]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">cast</span><span style="color: maroon; ">(</span><span style="color: #FF0080; font-weight: bold; ">percent_rank</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[number]</span><span style="color: maroon; ">)</span><span style="color: blue; ">as</span>&nbsp;<span style="color: black; font-style: italic; ">decimal</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">2</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percent_rank]</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##analytic_functions_01</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;Using&nbsp;cume_dist()&nbsp;and&nbsp;percent_rank()to&nbsp;identify&nbsp;worst&nbsp;performing&nbsp;queries&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[text]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[total_elapsed_time]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">cast</span><span style="color: maroon; ">(</span><span style="color: #FF0080; font-weight: bold; ">cume_dist</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[total_elapsed_time]</span><span style="color: maroon; ">)</span><span style="color: blue; ">as</span>&nbsp;<span style="color: black; font-style: italic; ">decimal</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">2</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[cumulative_distribution]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">cast</span><span style="color: maroon; ">(</span><span style="color: #FF0080; font-weight: bold; ">percent_rank</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[total_elapsed_time]</span><span style="color: maroon; ">)</span><span style="color: blue; ">as</span>&nbsp;<span style="color: black; font-style: italic; ">decimal</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">2</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percent_rank]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: silver; ">*</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[sys]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[dm_exec_query_stats]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">cross</span>&nbsp;<span style="color: maroon; ">apply</span>&nbsp;<span style="color: maroon; ">[sys]</span><span style="color: silver; ">.</span><span style="color: #FF0080; font-weight: bold; ">[dm_exec_sql_text]</span><span style="color: maroon; ">(</span><span style="color: maroon; ">sql_handle</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">order</span>&nbsp;&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[cumulative_distribution]</span>&nbsp;<span style="color: blue; ">desc</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">/*&nbsp;
<br/>&nbsp;&nbsp;FIRST_VALUE&nbsp;
<br/>&nbsp;&nbsp;Returns&nbsp;the&nbsp;first&nbsp;value&nbsp;in&nbsp;an&nbsp;ordered&nbsp;set&nbsp;of&nbsp;values&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;
<br/>
<br/>&nbsp;&nbsp;FIRST_VALUE&nbsp;(&nbsp;[scalar_expression&nbsp;]&nbsp;)&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;partition_by_clause&nbsp;]&nbsp;order_by_clause&nbsp;[&nbsp;rows_range_clause&nbsp;]&nbsp;)&nbsp;&nbsp;
<br/>
<br/>&nbsp;&nbsp;LAST_VALUE&nbsp;
<br/>&nbsp;&nbsp;Returns&nbsp;the&nbsp;last&nbsp;value&nbsp;in&nbsp;an&nbsp;ordered&nbsp;set&nbsp;of&nbsp;values&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;
<br/>
<br/>&nbsp;&nbsp;LAST_VALUE&nbsp;(&nbsp;[scalar_expression&nbsp;)&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;partition_by_clause&nbsp;]&nbsp;order_by_clause&nbsp;rows_range_clause&nbsp;)&nbsp;
<br/>
<br/>&nbsp;&nbsp;OVER()&nbsp;
<br/>&nbsp;&nbsp;OVER&nbsp;(&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;]&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;]&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;]&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;
<br/>&nbsp;&nbsp;ROWS&nbsp;|&nbsp;RANGE&nbsp;-&nbsp;Further&nbsp;limits&nbsp;the&nbsp;rows&nbsp;within&nbsp;the&nbsp;partition&nbsp;by&nbsp;specifying&nbsp;start&nbsp;and&nbsp;end&nbsp;points&nbsp;within&nbsp;the&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;partition.&nbsp;This&nbsp;is&nbsp;done&nbsp;by&nbsp;specifying&nbsp;a&nbsp;range&nbsp;of&nbsp;rows&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;current&nbsp;row&nbsp;either&nbsp;by&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;logical&nbsp;association&nbsp;or&nbsp;physical&nbsp;association.&nbsp;Physical&nbsp;association&nbsp;is&nbsp;achieved&nbsp;by&nbsp;using&nbsp;the&nbsp;ROWS&nbsp;clause.&nbsp;&nbsp;
<br/>&nbsp;&nbsp;UNBOUNDED&nbsp;PRECEDING&nbsp;-&nbsp;Specifies&nbsp;that&nbsp;the&nbsp;window&nbsp;starts&nbsp;at&nbsp;the&nbsp;first&nbsp;row&nbsp;of&nbsp;the&nbsp;partition.&nbsp;UNBOUNDED&nbsp;PRECEDING&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;only&nbsp;be&nbsp;specified&nbsp;as&nbsp;window&nbsp;starting&nbsp;point.&nbsp;&nbsp;
<br/>&nbsp;&nbsp;UNBOUNDED&nbsp;FOLLOWING&nbsp;-&nbsp;Specifies&nbsp;that&nbsp;the&nbsp;window&nbsp;ends&nbsp;at&nbsp;the&nbsp;last&nbsp;row&nbsp;of&nbsp;the&nbsp;partition.&nbsp;UNBOUNDED&nbsp;FOLLOWING&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;only&nbsp;be&nbsp;specified&nbsp;as&nbsp;a&nbsp;window&nbsp;end&nbsp;point.&nbsp;&nbsp;
<br/>*/</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">object_id</span><span style="color: maroon; ">(</span><span style="color: red; ">N'tempdb..##history_table'</span><span style="color: silver; ">,</span>&nbsp;<span style="color: red; ">N'U'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">not</span>&nbsp;<span style="color: blue; ">null</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">drop</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##history_table</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">create</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##history_table</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">[id]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[int]</span>&nbsp;<span style="color: blue; ">identity</span><span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[color]</span>&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[nvarchar]</span><span style="color: maroon; ">(</span><span style="color: black; ">250</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[object]</span>&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[nvarchar]</span><span style="color: maroon; ">(</span><span style="color: black; ">250</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[created]</span>&nbsp;<span style="color: black; font-style: italic; ">[date]</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">declare</span>&nbsp;<span style="color: #8000FF; ">@jan</span>&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[date]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: red; ">N'2013-01-01'</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #8000FF; ">@feb</span>&nbsp;<span style="color: black; font-style: italic; ">[date]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: red; ">N'2013-02-01'</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #8000FF; ">@mar</span>&nbsp;<span style="color: black; font-style: italic; ">[date]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: red; ">N'2013-03-01'</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #8000FF; ">@apr</span>&nbsp;<span style="color: black; font-style: italic; ">[date]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: red; ">N'2013-04-01'</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #8000FF; ">@may</span>&nbsp;<span style="color: black; font-style: italic; ">[date]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: red; ">N'2013-05-01'</span><span style="color: silver; ">;</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##history_table</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[color]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[object]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[created]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'purple'</span><span style="color: silver; ">,</span><span style="color: red; ">N'dogs'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@jan</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'purple'</span><span style="color: silver; ">,</span><span style="color: red; ">N'kittens'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@feb</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'purple'</span><span style="color: silver; ">,</span><span style="color: red; ">N'bunnies'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@mar</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'purple'</span><span style="color: silver; ">,</span><span style="color: red; ">N'chicks'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@apr</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'yellow'</span><span style="color: silver; ">,</span><span style="color: red; ">N'stars'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@jan</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'yellow'</span><span style="color: silver; ">,</span><span style="color: red; ">N'moons'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@feb</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'yellow'</span><span style="color: silver; ">,</span><span style="color: red; ">N'clovers'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@mar</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'green'</span><span style="color: silver; ">,</span><span style="color: red; ">N'chair'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@feb</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'green'</span><span style="color: silver; ">,</span><span style="color: red; ">N'sofa'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@mar</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'green'</span><span style="color: silver; ">,</span><span style="color: red; ">N'desk'</span><span style="color: silver; ">,</span><span style="color: #8000FF; ">@may</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;&nbsp;Displays&nbsp;each&nbsp;record&nbsp;along&nbsp;with&nbsp;the&nbsp;most&nbsp;recent&nbsp;value&nbsp;in&nbsp;the&nbsp;partition&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: blue; ">with</span>&nbsp;<span style="color: maroon; ">[get_most_recent_records]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[id]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[color]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[object]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[created]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #FF0080; font-weight: bold; ">first_value</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[id]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[created]</span>&nbsp;<span style="color: blue; ">asc</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[first_value]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #FF0080; font-weight: bold; ">first_value</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[created]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[created]</span>&nbsp;<span style="color: blue; ">asc</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[first_date]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #FF0080; font-weight: bold; ">last_value</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[id]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[created]</span>&nbsp;<span style="color: blue; ">asc</span>&nbsp;<span style="color: maroon; ">range</span>&nbsp;<span style="color: blue; ">between</span>&nbsp;<span style="color: blue; ">unbounded</span>&nbsp;<span style="color: blue; ">preceding</span>&nbsp;<span style="color: blue; ">and</span>&nbsp;<span style="color: blue; ">unbounded</span>&nbsp;<span style="color: maroon; ">following</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[last_value]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #FF0080; font-weight: bold; ">last_value</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[created]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[created]</span>&nbsp;<span style="color: blue; ">asc</span>&nbsp;<span style="color: maroon; ">range</span>&nbsp;<span style="color: blue; ">between</span>&nbsp;<span style="color: blue; ">unbounded</span>&nbsp;<span style="color: blue; ">preceding</span>&nbsp;<span style="color: blue; ">and</span>&nbsp;<span style="color: blue; ">unbounded</span>&nbsp;<span style="color: maroon; ">following</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[last_date]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##history_table</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/><span style="color: maroon; ">[get_color]</span>&nbsp;<span style="color: blue; ">as</span><span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[color]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[first_value]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[last_value]</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[get_most_recent_records]</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">group</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[first_value]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[last_value]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[get_color]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[color]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[first_history_table]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[object]</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[firstvalue]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[last_history_table]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[object]</span>&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[lastvalue]</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[get_color]</span>
<br/><span style="color: blue; ">join</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##history_table</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[last_history_table]</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">on</span>&nbsp;<span style="color: maroon; ">[last_history_table]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[id]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: maroon; ">[get_color]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[last_value]</span>
<br/><span style="color: blue; ">join</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##history_table</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[first_history_table]</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">on</span>&nbsp;<span style="color: maroon; ">[first_history_table]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[id]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: maroon; ">[get_color]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[first_value]</span>
<br/><span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[get_color]</span><span style="color: silver; ">.</span><span style="color: maroon; ">[color]</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">/*&nbsp;
<br/>&nbsp;&nbsp;LAG&nbsp;&nbsp;
<br/>&nbsp;&nbsp;Accesses&nbsp;data&nbsp;from&nbsp;a&nbsp;previous&nbsp;row&nbsp;in&nbsp;the&nbsp;same&nbsp;result&nbsp;set&nbsp;without&nbsp;the&nbsp;use&nbsp;of&nbsp;a&nbsp;self-join&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;LAG&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;provides&nbsp;access&nbsp;to&nbsp;a&nbsp;row&nbsp;at&nbsp;a&nbsp;given&nbsp;physical&nbsp;offset&nbsp;that&nbsp;comes&nbsp;before&nbsp;the&nbsp;current&nbsp;row.&nbsp;Use&nbsp;this&nbsp;analytic&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;in&nbsp;a&nbsp;SELECT&nbsp;statement&nbsp;to&nbsp;compare&nbsp;values&nbsp;in&nbsp;the&nbsp;current&nbsp;row&nbsp;with&nbsp;values&nbsp;in&nbsp;a&nbsp;previous&nbsp;row.&nbsp;&nbsp;
<br/>
<br/>&nbsp;&nbsp;LAG&nbsp;(scalar_expression&nbsp;[,offset]&nbsp;[,default])&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;partition_by_clause&nbsp;]&nbsp;order_by_clause&nbsp;)&nbsp;
<br/>
<br/>&nbsp;&nbsp;LEAD&nbsp;
<br/>&nbsp;&nbsp;Accesses&nbsp;data&nbsp;from&nbsp;a&nbsp;subsequent&nbsp;row&nbsp;in&nbsp;the&nbsp;same&nbsp;result&nbsp;set&nbsp;without&nbsp;the&nbsp;use&nbsp;of&nbsp;a&nbsp;self-join&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;LEAD&nbsp;provides&nbsp;access&nbsp;to&nbsp;a&nbsp;row&nbsp;at&nbsp;a&nbsp;given&nbsp;physical&nbsp;offset&nbsp;that&nbsp;follows&nbsp;the&nbsp;current&nbsp;row.&nbsp;Use&nbsp;this&nbsp;analytic&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;in&nbsp;a&nbsp;SELECT&nbsp;statement&nbsp;to&nbsp;compare&nbsp;values&nbsp;in&nbsp;the&nbsp;current&nbsp;row&nbsp;with&nbsp;values&nbsp;in&nbsp;a&nbsp;following&nbsp;row.&nbsp;&nbsp;
<br/>
<br/>&nbsp;&nbsp;LEAD&nbsp;(&nbsp;scalar_expression&nbsp;[&nbsp;,offset&nbsp;]&nbsp;,&nbsp;[&nbsp;default&nbsp;]&nbsp;)&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;partition_by_clause&nbsp;]&nbsp;order_by_clause&nbsp;)&nbsp;
<br/>
<br/>*/</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">object_id</span><span style="color: maroon; ">(</span><span style="color: red; ">N'tempdb..##lag_table'</span><span style="color: silver; ">,</span>&nbsp;<span style="color: red; ">N'U'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">not</span>&nbsp;<span style="color: blue; ">null</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">drop</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##lag_table</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">create</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##lag_table</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">[id]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[int]</span>&nbsp;<span style="color: blue; ">identity</span><span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[model]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[sysname]</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[residual]</span>&nbsp;<span style="color: black; font-style: italic; ">[decimal]</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">9</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">2</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[created]</span>&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[date]</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##lag_table</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[model]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[residual]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[created]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelA'</span><span style="color: silver; ">,</span><span style="color: black; ">10</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelA'</span><span style="color: silver; ">,</span><span style="color: black; ">11</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelA'</span><span style="color: silver; ">,</span><span style="color: black; ">12</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-02-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelA'</span><span style="color: silver; ">,</span><span style="color: black; ">13</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-02-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelA'</span><span style="color: silver; ">,</span><span style="color: black; ">14</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-03-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelB'</span><span style="color: silver; ">,</span><span style="color: black; ">20</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-03-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelB'</span><span style="color: silver; ">,</span><span style="color: black; ">21</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-04-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelB'</span><span style="color: silver; ">,</span><span style="color: black; ">22</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-04-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelB'</span><span style="color: silver; ">,</span><span style="color: black; ">23</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-05-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'modelB'</span><span style="color: silver; ">,</span><span style="color: black; ">24</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-05-01'</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;&nbsp;Select&nbsp;a&nbsp;prior&nbsp;value&nbsp;based&nbsp;on&nbsp;a&nbsp;stated&nbsp;interval&nbsp;or&nbsp;count&nbsp;</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[id]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[model]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[residual]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">lag</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[residual]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1.0</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[model]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[id]</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[prior]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">lag</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[residual]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1.0</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[id]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: silver; ">-</span>&nbsp;<span style="color: maroon; ">[residual]</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[prior_delta]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">lead</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[residual]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1.0</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[model]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[id]</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[next]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">lead</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[residual]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1.0</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[id]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: silver; ">-</span>&nbsp;<span style="color: maroon; ">[residual]</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[next_delta]</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##lag_table</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;&nbsp;Select&nbsp;a&nbsp;prior&nbsp;value&nbsp;based&nbsp;on&nbsp;a&nbsp;calculated&nbsp;[date]&nbsp;interval&nbsp;</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[id]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[model]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[residual]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[created]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">(</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">datediff</span><span style="color: maroon; ">(</span><span style="color: maroon; ">month</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[created]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">cast</span><span style="color: maroon; ">(</span><span style="color: fuchsia; font-style: italic; ">getdate</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: black; font-style: italic; ">[date]</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[date_difference]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">lag</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[residual]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">datediff</span><span style="color: maroon; ">(</span><span style="color: maroon; ">month</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[created]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">cast</span><span style="color: maroon; ">(</span><span style="color: fuchsia; font-style: italic; ">getdate</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: black; font-style: italic; ">[date]</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[model]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[id]</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[prior]</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##lag_table</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">/*&nbsp;
<br/>&nbsp;&nbsp;Percentile:&nbsp;"In&nbsp;statistics,&nbsp;a&nbsp;percentile&nbsp;(or&nbsp;a&nbsp;centile)&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;a&nbsp;variable&nbsp;below&nbsp;which&nbsp;a&nbsp;certain&nbsp;percent&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;observations&nbsp;fall.&nbsp;For&nbsp;example,&nbsp;the&nbsp;20th&nbsp;percentile&nbsp;is&nbsp;the&nbsp;value&nbsp;(or&nbsp;score)&nbsp;below&nbsp;which&nbsp;20&nbsp;percent&nbsp;of&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;observations&nbsp;may&nbsp;be&nbsp;found.&nbsp;The&nbsp;term&nbsp;percentile&nbsp;and&nbsp;the&nbsp;related&nbsp;term&nbsp;percentile&nbsp;rank&nbsp;are&nbsp;often&nbsp;used&nbsp;in&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;reporting&nbsp;of&nbsp;scores&nbsp;from&nbsp;norm-referenced&nbsp;tests.&nbsp;For&nbsp;example,&nbsp;if&nbsp;a&nbsp;score&nbsp;is&nbsp;in&nbsp;the&nbsp;86th&nbsp;percentile,&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;is&nbsp;higher&nbsp;than&nbsp;85%&nbsp;of&nbsp;the&nbsp;other&nbsp;scores.&nbsp;
<br/>
<br/>&nbsp;&nbsp;PERCENTILE_CONT()&nbsp;-&nbsp;Percentile&nbsp;Continuous&nbsp;
<br/>&nbsp;&nbsp;Calculates&nbsp;a&nbsp;percentile&nbsp;based&nbsp;on&nbsp;a&nbsp;continuous&nbsp;distribution&nbsp;of&nbsp;the&nbsp;column&nbsp;value&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;The&nbsp;result&nbsp;is&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;interpolated&nbsp;and&nbsp;might&nbsp;not&nbsp;be&nbsp;equal&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;specific&nbsp;values&nbsp;in&nbsp;the&nbsp;column.&nbsp;&nbsp;
<br/>&nbsp;&nbsp;PERCENTILE_CONT&nbsp;interpolates&nbsp;the&nbsp;appropriate&nbsp;value,&nbsp;whether&nbsp;or&nbsp;not&nbsp;it&nbsp;exists&nbsp;in&nbsp;the&nbsp;data&nbsp;set&nbsp;
<br/>
<br/>&nbsp;&nbsp;PERCENTILE_CONT&nbsp;(&nbsp;PERCENTILE&nbsp;)&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;WITHIN&nbsp;GROUP&nbsp;(&nbsp;ORDER&nbsp;BY&nbsp;order_by_expression&nbsp;[&nbsp;ASC&nbsp;|&nbsp;DESC&nbsp;]&nbsp;)&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;&nbsp;]&nbsp;)&nbsp;
<br/>
<br/>&nbsp;&nbsp;PERCENTILE_DISC()&nbsp;-&nbsp;Percentile&nbsp;Distinct&nbsp;
<br/>&nbsp;&nbsp;Computes&nbsp;a&nbsp;specific&nbsp;percentile&nbsp;for&nbsp;sorted&nbsp;values&nbsp;in&nbsp;an&nbsp;entire&nbsp;rowset&nbsp;or&nbsp;within&nbsp;distinct&nbsp;partitions&nbsp;of&nbsp;a&nbsp;rowset&nbsp;in&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;SQL&nbsp;Server&nbsp;2012.&nbsp;For&nbsp;a&nbsp;given&nbsp;percentile&nbsp;value&nbsp;P,&nbsp;PERCENTILE_DISC&nbsp;sorts&nbsp;the&nbsp;values&nbsp;of&nbsp;the&nbsp;expression&nbsp;in&nbsp;the&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;clause&nbsp;and&nbsp;returns&nbsp;the&nbsp;value&nbsp;with&nbsp;the&nbsp;smallest&nbsp;CUME_DIST&nbsp;value&nbsp;(with&nbsp;respect&nbsp;to&nbsp;the&nbsp;same&nbsp;sort&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;specification)&nbsp;that&nbsp;is&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;P.&nbsp;For&nbsp;example,&nbsp;PERCENTILE_DISC&nbsp;(0.5)&nbsp;will&nbsp;compute&nbsp;the&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;50th&nbsp;percentile&nbsp;(that&nbsp;is,&nbsp;the&nbsp;median)&nbsp;of&nbsp;an&nbsp;expression.&nbsp;PERCENTILE_DISC&nbsp;calculates&nbsp;the&nbsp;percentile&nbsp;based&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;a&nbsp;discrete&nbsp;distribution&nbsp;of&nbsp;the&nbsp;column&nbsp;values;&nbsp;the&nbsp;result&nbsp;is&nbsp;equal&nbsp;to&nbsp;a&nbsp;specific&nbsp;value&nbsp;in&nbsp;the&nbsp;column.&nbsp;&nbsp;
<br/>&nbsp;&nbsp;PERCENTILE_DISC&nbsp;always&nbsp;returns&nbsp;an&nbsp;actual&nbsp;value&nbsp;from&nbsp;the&nbsp;set.&nbsp;
<br/>
<br/>&nbsp;&nbsp;PERCENTILE_DISC&nbsp;(&nbsp;PERCENTILE&nbsp;)&nbsp;WITHIN&nbsp;GROUP&nbsp;(&nbsp;ORDER&nbsp;BY&nbsp;order_by_expression&nbsp;[&nbsp;ASC&nbsp;|&nbsp;DESC&nbsp;]&nbsp;)&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OVER&nbsp;(&nbsp;[&nbsp;&nbsp;]&nbsp;)&nbsp;
<br/>*/</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">object_id</span><span style="color: maroon; ">(</span><span style="color: red; ">N'tempdb..##percentile_continuous'</span><span style="color: silver; ">,</span>&nbsp;<span style="color: red; ">N'U'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">not</span>&nbsp;<span style="color: blue; ">null</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">drop</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##percentile_continuous</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">create</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##percentile_continuous</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">[id]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[int]</span>&nbsp;<span style="color: blue; ">identity</span><span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[group]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[nvarchar]</span><span style="color: maroon; ">(</span><span style="color: black; ">25</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[individual]</span>&nbsp;<span style="color: black; font-style: italic; ">[nvarchar]</span><span style="color: maroon; ">(</span><span style="color: black; ">25</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[rate]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">decimal</span><span style="color: maroon; ">(</span><span style="color: black; ">9</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">2</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##percentile_continuous</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[group]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[individual]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[rate]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupA'</span><span style="color: silver; ">,</span><span style="color: red; ">'Fred'</span><span style="color: silver; ">,</span><span style="color: black; ">1022.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupA'</span><span style="color: silver; ">,</span><span style="color: red; ">'Lisa'</span><span style="color: silver; ">,</span><span style="color: black; ">1954.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupA'</span><span style="color: silver; ">,</span><span style="color: red; ">'Victory'</span><span style="color: silver; ">,</span><span style="color: black; ">5954.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupA'</span><span style="color: silver; ">,</span><span style="color: red; ">'Tom'</span><span style="color: silver; ">,</span><span style="color: black; ">9125.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupB'</span><span style="color: silver; ">,</span><span style="color: red; ">'Ed'</span><span style="color: silver; ">,</span><span style="color: black; ">2725.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupB'</span><span style="color: silver; ">,</span><span style="color: red; ">'June'</span><span style="color: silver; ">,</span><span style="color: black; ">4315.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupB'</span><span style="color: silver; ">,</span><span style="color: red; ">'Sally'</span><span style="color: silver; ">,</span><span style="color: black; ">7684.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupC'</span><span style="color: silver; ">,</span><span style="color: red; ">'Jeff'</span><span style="color: silver; ">,</span><span style="color: black; ">3587.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupC'</span><span style="color: silver; ">,</span><span style="color: red; ">'Kim'</span><span style="color: silver; ">,</span><span style="color: black; ">6987.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'GroupC'</span><span style="color: silver; ">,</span><span style="color: red; ">'Joe'</span><span style="color: silver; ">,</span><span style="color: black; ">8758.00</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;Note&nbsp;that&nbsp;PERCENTILE_CONT&nbsp;calculates&nbsp;a&nbsp;value,&nbsp;where&nbsp;PERCENTILE_DISC&nbsp;returns&nbsp;an&nbsp;existing&nbsp;value.&nbsp;</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[group]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #FF0080; font-weight: bold; ">percentile_cont</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">0.2</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">within</span>&nbsp;<span style="color: blue; ">group</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[rate]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[group]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percentile_cont&nbsp;(0.2)&nbsp;-&nbsp;calculated&nbsp;value]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">percentile_cont</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">0.5</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">within</span>&nbsp;<span style="color: blue; ">group</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[rate]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[group]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percentile_cont&nbsp;(0.5)&nbsp;-&nbsp;calculated&nbsp;value]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">percentile_cont</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">0.7</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">within</span>&nbsp;<span style="color: blue; ">group</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[rate]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[group]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percentile_cont&nbsp;(0.7)&nbsp;-&nbsp;calculated&nbsp;value]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">percentile_disc</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">0.2</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">within</span>&nbsp;<span style="color: blue; ">group</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[rate]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[group]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percentile_disc&nbsp;(0.5)&nbsp;-&nbsp;existing&nbsp;value]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">percentile_disc</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">0.5</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">within</span>&nbsp;<span style="color: blue; ">group</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[rate]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[group]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percentile_disc&nbsp;(0.5)&nbsp;-&nbsp;existing&nbsp;value]</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">percentile_disc</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">0.7</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">within</span>&nbsp;<span style="color: blue; ">group</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[rate]</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[group]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[percentile_disc&nbsp;(0.7)&nbsp;-&nbsp;existing&nbsp;value]</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##percentile_continuous</span><span style="color: silver; ">;</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;</span>
</span></div>

			  
			  </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
</html>
