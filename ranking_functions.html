<html>
  <head>
    <meta name="generator" content="HTML Tidy for HTML5 (experimental) for Windows https://github.com/w3c/tidy-html5/tree/c63cc39" />
    <title>[th&#601;_her&#601;tik]</title>
    <link rel="shortcut icon" href=".\source\image\chamomile.ico" />
    <link rel="stylesheet" type="text/css" href=".\source\common.css" />
  </head>
  <body>
    <table width="100%" style="border-collapse: collapse;">
      <tr>
        <td colspan="2" style="padding-left:25px; padding-right:25px;">
          <iframe src="./header.html" width="100%" height="350" scrolling="no" seamless="" frameborder="0"></iframe>
        </td>
      </tr>
    </table>
    <table width="100%" style="border-collapse: collapse;">
      <tr>
        <td colspan="2" style="padding-left:25px; padding-right:25px;">
          <table class="content" width="98%" style="border-collapse: collapse;">
            <tr class="menu">
              <td colspan="2" style="padding-left:25px; padding-right:25px;">
                <iframe src="./menu__home.html" width="100%" height="55" scrolling="no" seamless="" frameborder="0"></iframe>
              </td>
            </tr>
            <tr class="menu">
              <td colspan="2" style="padding-left:25px; padding-right:25px;">
                <iframe src="./menu__presentation.html" width="100%" height="150" scrolling="no" seamless="" frameborder="0"></iframe>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="100%" style="border-collapse: collapse;">
      <tr>
        <td colspan="2" style="padding-left:25px; padding-right:25px;">
          <!--  -->
          <!-- begin content table -->
          <table class="content">
            <tr>
              <td>
			  
<div><span style="font-family: Courier New; font-size: 10pt;">
<span style="color: green; font-style: italic; ">/*
<br/>&nbsp;&nbsp;All&nbsp;content&nbsp;is&nbsp;licensed&nbsp;as&nbsp;[chamomile]&nbsp;(http://www.KELightsey.com/license.html)&nbsp;and&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;copyright&nbsp;Katherine&nbsp;Elizabeth&nbsp;Lightsey,&nbsp;1959-2014&nbsp;(aka;&nbsp;my&nbsp;life),&nbsp;all&nbsp;rights&nbsp;reserved,
<br/>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;as&nbsp;open&nbsp;source&nbsp;under&nbsp;the&nbsp;GNU&nbsp;Affero&nbsp;GPL&nbsp;(http://www.gnu.org/licenses/agpl-3.0.html).
<br/>&nbsp;&nbsp;---------------------------------------------
<br/>
<br/>&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;--&nbsp;&nbsp;description
<br/>&nbsp;&nbsp;---------------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;Ranking&nbsp;functions&nbsp;return&nbsp;a&nbsp;ranking&nbsp;value&nbsp;for&nbsp;each&nbsp;row&nbsp;in&nbsp;a&nbsp;partition.&nbsp;Depending&nbsp;on&nbsp;the&nbsp;function&nbsp;that&nbsp;is&nbsp;used,&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;some&nbsp;rows&nbsp;might&nbsp;receive&nbsp;the&nbsp;same&nbsp;value&nbsp;as&nbsp;other&nbsp;rows.&nbsp;Ranking&nbsp;functions&nbsp;are&nbsp;nondeterministic.&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;ROW_NUMBER()&nbsp;-&nbsp;Returns&nbsp;the&nbsp;sequential&nbsp;number&nbsp;of&nbsp;a&nbsp;row&nbsp;within&nbsp;a&nbsp;partition&nbsp;of&nbsp;a&nbsp;result&nbsp;set,&nbsp;starting&nbsp;at&nbsp;1&nbsp;for&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;first&nbsp;row&nbsp;in&nbsp;each&nbsp;partition.&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;RANK()&nbsp;-&nbsp;Returns&nbsp;the&nbsp;rank&nbsp;of&nbsp;each&nbsp;row&nbsp;within&nbsp;the&nbsp;partition&nbsp;of&nbsp;a&nbsp;result&nbsp;set.&nbsp;The&nbsp;rank&nbsp;of&nbsp;a&nbsp;row&nbsp;is&nbsp;one&nbsp;plus&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;number&nbsp;of&nbsp;ranks&nbsp;that&nbsp;come&nbsp;before&nbsp;the&nbsp;row&nbsp;in&nbsp;question.&nbsp;If&nbsp;two&nbsp;or&nbsp;more&nbsp;rows&nbsp;tie&nbsp;for&nbsp;a&nbsp;rank,&nbsp;each&nbsp;tied&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;rows&nbsp;receives&nbsp;the&nbsp;same&nbsp;rank.&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;two&nbsp;top&nbsp;salespeople&nbsp;have&nbsp;the&nbsp;same&nbsp;SalesYTD&nbsp;value,&nbsp;they&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;are&nbsp;both&nbsp;ranked&nbsp;one.&nbsp;The&nbsp;salesperson&nbsp;with&nbsp;the&nbsp;next&nbsp;highest&nbsp;SalesYTD&nbsp;is&nbsp;ranked&nbsp;number&nbsp;three,&nbsp;because&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;are&nbsp;two&nbsp;rows&nbsp;that&nbsp;are&nbsp;ranked&nbsp;higher.&nbsp;Therefore,&nbsp;the&nbsp;RANK&nbsp;function&nbsp;does&nbsp;not&nbsp;always&nbsp;return&nbsp;consecutive&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;integers.&nbsp;The&nbsp;sort&nbsp;order&nbsp;that&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;whole&nbsp;query&nbsp;determines&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;rows&nbsp;appear&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;a&nbsp;result&nbsp;set.&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;DENSE_RANK()&nbsp;-&nbsp;Returns&nbsp;the&nbsp;rank&nbsp;of&nbsp;rows&nbsp;within&nbsp;the&nbsp;partition&nbsp;of&nbsp;a&nbsp;result&nbsp;set,&nbsp;without&nbsp;any&nbsp;gaps&nbsp;in&nbsp;the&nbsp;ranking.&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;rank&nbsp;of&nbsp;a&nbsp;row&nbsp;is&nbsp;one&nbsp;plus&nbsp;the&nbsp;number&nbsp;of&nbsp;distinct&nbsp;ranks&nbsp;that&nbsp;come&nbsp;before&nbsp;the&nbsp;row&nbsp;in&nbsp;question.&nbsp;If&nbsp;two&nbsp;or&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;more&nbsp;rows&nbsp;tie&nbsp;for&nbsp;a&nbsp;rank&nbsp;in&nbsp;the&nbsp;same&nbsp;partition,&nbsp;each&nbsp;tied&nbsp;rows&nbsp;receives&nbsp;the&nbsp;same&nbsp;rank.&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;two&nbsp;top&nbsp;salespeople&nbsp;have&nbsp;the&nbsp;same&nbsp;SalesYTD&nbsp;value,&nbsp;they&nbsp;are&nbsp;both&nbsp;ranked&nbsp;one.&nbsp;The&nbsp;salesperson&nbsp;with&nbsp;the&nbsp;next&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;highest&nbsp;SalesYTD&nbsp;is&nbsp;ranked&nbsp;number&nbsp;two.&nbsp;This&nbsp;is&nbsp;one&nbsp;more&nbsp;than&nbsp;the&nbsp;number&nbsp;of&nbsp;distinct&nbsp;rows&nbsp;that&nbsp;come&nbsp;before&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;row.&nbsp;Therefore,&nbsp;the&nbsp;numbers&nbsp;returned&nbsp;by&nbsp;the&nbsp;DENSE_RANK&nbsp;function&nbsp;do&nbsp;not&nbsp;have&nbsp;gaps&nbsp;and&nbsp;always&nbsp;have&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;consecutive&nbsp;ranks.&nbsp;The&nbsp;sort&nbsp;order&nbsp;used&nbsp;for&nbsp;the&nbsp;whole&nbsp;query&nbsp;determines&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;rows&nbsp;appear&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;a&nbsp;result.&nbsp;This&nbsp;implies&nbsp;that&nbsp;a&nbsp;row&nbsp;ranked&nbsp;number&nbsp;one&nbsp;does&nbsp;not&nbsp;have&nbsp;to&nbsp;be&nbsp;the&nbsp;first&nbsp;row&nbsp;in&nbsp;the&nbsp;partition.&nbsp;
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;NTILE()&nbsp;-&nbsp;Distributes&nbsp;the&nbsp;rows&nbsp;in&nbsp;an&nbsp;ordered&nbsp;partition&nbsp;into&nbsp;a&nbsp;specified&nbsp;number&nbsp;of&nbsp;groups.&nbsp;The&nbsp;groups&nbsp;are&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;numbered,&nbsp;starting&nbsp;at&nbsp;one.&nbsp;For&nbsp;each&nbsp;row,&nbsp;NTILE&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;the&nbsp;group&nbsp;to&nbsp;which&nbsp;the&nbsp;row&nbsp;belongs.&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;in&nbsp;a&nbsp;partition&nbsp;is&nbsp;not&nbsp;divisible&nbsp;by&nbsp;integer_expression,&nbsp;this&nbsp;will&nbsp;cause&nbsp;groups&nbsp;of&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;two&nbsp;sizes&nbsp;that&nbsp;differ&nbsp;by&nbsp;one&nbsp;member.&nbsp;Larger&nbsp;groups&nbsp;come&nbsp;before&nbsp;smaller&nbsp;groups&nbsp;in&nbsp;the&nbsp;order&nbsp;specified&nbsp;by&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;OVER&nbsp;clause.&nbsp;For&nbsp;example&nbsp;if&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;rows&nbsp;is&nbsp;53&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;groups&nbsp;is&nbsp;five,&nbsp;the&nbsp;first&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;three&nbsp;groups&nbsp;will&nbsp;have&nbsp;11&nbsp;rows&nbsp;and&nbsp;the&nbsp;two&nbsp;remaining&nbsp;groups&nbsp;will&nbsp;have&nbsp;10&nbsp;rows&nbsp;each.&nbsp;If&nbsp;on&nbsp;the&nbsp;other&nbsp;hand&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;rows&nbsp;is&nbsp;divisible&nbsp;by&nbsp;the&nbsp;number&nbsp;of&nbsp;groups,&nbsp;the&nbsp;rows&nbsp;will&nbsp;be&nbsp;evenly&nbsp;distributed&nbsp;among&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;groups.&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;rows&nbsp;is&nbsp;50,&nbsp;and&nbsp;there&nbsp;are&nbsp;five&nbsp;groups,&nbsp;each&nbsp;bucket&nbsp;will&nbsp;&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;contain&nbsp;10&nbsp;rows.&nbsp;
<br/>
<br/>&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;--&nbsp;&nbsp;notes
<br/>&nbsp;&nbsp;----------------------------------------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;presentation&nbsp;is&nbsp;designed&nbsp;to&nbsp;be&nbsp;run&nbsp;incrementally&nbsp;a&nbsp;code&nbsp;block&nbsp;at&nbsp;a&nbsp;time.&nbsp;
<br/>&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;blocks&nbsp;are&nbsp;delineated&nbsp;as:
<br/>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;code&nbsp;block&nbsp;begin
<br/>&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<run&nbsp;code&nbsp;here>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;code&nbsp;block&nbsp;end
<br/>&nbsp;&nbsp;&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;
<br/>&nbsp;&nbsp;--
<br/>&nbsp;&nbsp;--&nbsp;references
<br/>&nbsp;&nbsp;----------------------------------------------------------------------
<br/>&nbsp;&nbsp;Ranking&nbsp;Functions&nbsp;(Transact-SQL)&nbsp;-&nbsp;http://msdn.microsoft.com/en-us/library/ms189798.aspx
<br/>*/</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;begin</span>
<br/><span style="color: blue; ">use</span>&nbsp;<span style="color: maroon; ">[chamomile]</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">schema_id</span><span style="color: maroon; ">(</span><span style="color: red; ">N'presentation'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">null</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">execute</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'create&nbsp;schema&nbsp;presentation'</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;code&nbsp;block&nbsp;end</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">object_id</span><span style="color: maroon; ">(</span><span style="color: red; ">N'tempdb..##flower'</span><span style="color: silver; ">,</span>&nbsp;<span style="color: red; ">N'U'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">not</span>&nbsp;<span style="color: blue; ">null</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">drop</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##flower</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">create</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##flower</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">[id]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[int]</span>&nbsp;<span style="color: blue; ">identity</span><span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span>&nbsp;<span style="color: black; ">1</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[flower]</span>&nbsp;<span style="color: black; font-style: italic; ">[sysname]</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[color]</span>&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[sysname]</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[count]</span>&nbsp;&nbsp;<span style="color: black; font-style: italic; ">[int]</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##flower</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[flower]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[color]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span><span style="color: red; ">N'one'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span><span style="color: red; ">N'one'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span><span style="color: red; ">N'one'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">2</span><span style="color: silver; ">,</span><span style="color: red; ">N'two'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: silver; ">,</span><span style="color: red; ">N'three'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">4</span><span style="color: silver; ">,</span><span style="color: red; ">N'four'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">4</span><span style="color: silver; ">,</span><span style="color: red; ">N'four'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span><span style="color: red; ">N'five'</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[id]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[color]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">rank</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: red; ">N'Rank'</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">dense_rank</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: red; ">N'DenseRank'</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">row_number</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: red; ">N'RowNumber'</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">ntile</span><span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: red; ">N'NTile'</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##flower</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">object_id</span><span style="color: maroon; ">(</span><span style="color: red; ">N'tempdb..##flower'</span><span style="color: silver; ">,</span>&nbsp;<span style="color: red; ">N'U'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">not</span>&nbsp;<span style="color: blue; ">null</span>
<br/>&nbsp;&nbsp;<span style="color: blue; ">drop</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##flower</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">create</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##flower</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">[[id]]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;identity(1,&nbsp;1)
&nbsp;&nbsp;,&nbsp;[flower]</span>&nbsp;&nbsp;<span style="color: black; font-style: italic; ">nvarchar</span><span style="color: maroon; ">(</span><span style="color: black; ">50</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[salesdate]</span>&nbsp;<span style="color: black; font-style: italic; ">datetime</span>
<br/>&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[sales]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">money</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##flower</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[flower]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[salesdate]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[sales]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'tulip'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2005-01-01'</span><span style="color: silver; ">,</span><span style="color: black; ">12589</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'tulip'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2006-02-01'</span><span style="color: silver; ">,</span><span style="color: black; ">85456</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'tulip'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2007-03-01'</span><span style="color: silver; ">,</span><span style="color: black; ">32598</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'tulip'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2008-04-01'</span><span style="color: silver; ">,</span><span style="color: black; ">54946</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'tulip'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2009-05-01'</span><span style="color: silver; ">,</span><span style="color: black; ">38746</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'lily'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2005-01-01'</span><span style="color: silver; ">,</span><span style="color: black; ">18000</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'lily'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2006-02-01'</span><span style="color: silver; ">,</span><span style="color: black; ">65231</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'lily'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2007-03-01'</span><span style="color: silver; ">,</span><span style="color: black; ">87325</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'lily'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2008-04-01'</span><span style="color: silver; ">,</span><span style="color: black; ">35687</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'petunia'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2005-01-01'</span><span style="color: silver; ">,</span><span style="color: black; ">25000</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'petunia'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2006-02-01'</span><span style="color: silver; ">,</span><span style="color: black; ">25765</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'petunia'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2007-03-01'</span><span style="color: silver; ">,</span><span style="color: black; ">33256</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'petunia'</span><span style="color: silver; ">,</span><span style="color: red; ">N'2008-04-01'</span><span style="color: silver; ">,</span><span style="color: black; ">64125</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[id]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[salesdate]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[sales]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">row_number</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[sales]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[row_number]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">row_number</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">month</span><span style="color: maroon; ">(</span><span style="color: maroon; ">salesdate</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">month</span><span style="color: maroon; ">(</span><span style="color: maroon; ">salesdate</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[row_number&nbsp;by&nbsp;month]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">rank</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[rank]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">dense_rank</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[dense_rank]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: #FF0080; font-weight: bold; ">ntile</span><span style="color: maroon; ">(</span><span style="color: black; ">3</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[salesdate]</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">[ntile]</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##flower</span>
<br/><span style="color: blue; ">order</span>&nbsp;&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[sales]</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;&nbsp;ROW_NUMBER&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;&nbsp;Remove&nbsp;duplicates&nbsp;from&nbsp;a&nbsp;table&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: blue; ">declare</span>&nbsp;<span style="color: #8000FF; ">@duplicate</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">c</span><span style="color: maroon; ">[flower]</span>&nbsp;<span style="color: maroon; ">nvarchar</span><span style="color: maroon; ">(</span><span style="color: black; ">50</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;<span style="color: maroon; ">)</span><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: #8000FF; ">@duplicate</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">c</span><span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'white'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'white'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'white'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'white'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'red'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'red'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'red'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'blue'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'blue'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'blue'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'blue'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'blue'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: red; ">N'blue'</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;Note&nbsp;that&nbsp;the&nbsp;records&nbsp;are&nbsp;deleted&nbsp;directly&nbsp;from&nbsp;the&nbsp;CTE&nbsp;rather&nbsp;than&nbsp;from&nbsp;the&nbsp;table!&nbsp;</span><span style="color: blue; ">with</span>&nbsp;<span style="color: maroon; ">cte_deleteduplicates</span><span style="color: maroon; ">(</span><span style="color: maroon; ">c</span><span style="color: maroon; ">[flower]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">rnumber</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">c</span><span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">row_number</span><span style="color: maroon; ">(</span><span style="color: maroon; ">)</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">over</span>&nbsp;<span style="color: maroon; ">(</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">partition</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">c</span><span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">c</span><span style="color: maroon; ">[flower]</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">rnumber</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: #8000FF; ">@duplicate</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">delete</span>&nbsp;<span style="color: blue; ">from</span>&nbsp;<span style="color: maroon; ">cte_deleteduplicates</span>
<br/><span style="color: blue; ">where</span>&nbsp;&nbsp;<span style="color: maroon; ">rnumber</span>&nbsp;<span style="color: silver; ">&gt;</span>&nbsp;<span style="color: black; ">1</span><span style="color: silver; ">;</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">c</span><span style="color: maroon; ">[flower]</span>
<br/><span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: #8000FF; ">@duplicate</span><span style="color: silver; ">;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;**************************************************************************************************************************&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;&nbsp;ROW_NUMBER&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;&nbsp;Using&nbsp;row_number&nbsp;to&nbsp;get&nbsp;the&nbsp;most&nbsp;recent&nbsp;records&nbsp;from&nbsp;a&nbsp;record&nbsp;set.&nbsp;</span>
<br/><span style="color: green; font-style: italic; ">&#45;&#45;&nbsp;</span>
<br/><span style="color: blue; ">if</span>&nbsp;<span style="color: maroon; ">object_</span><span style="color: maroon; ">[id]</span><span style="color: maroon; ">(</span><span style="color: red; ">N'tempdb..##flower'</span><span style="color: silver; ">,</span>&nbsp;<span style="color: red; ">N'U'</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">is</span>&nbsp;<span style="color: blue; ">not</span>&nbsp;<span style="color: blue; ">null</span>&nbsp;<span style="color: blue; ">drop</span>&nbsp;<span style="color: blue; ">table</span>&nbsp;<span style="color: maroon; ">##flower</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: maroon; ">go</span>
<br/><span style="color: blue; ">insert</span>&nbsp;<span style="color: blue; ">into</span>&nbsp;<span style="color: maroon; ">##flower</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[flower]</span><span style="color: silver; ">,</span><span style="color: maroon; ">[color]</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">values</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-21'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-12'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">1</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-07'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">2</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-13'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">2</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-19'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">2</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-23'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">2</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-24'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-16'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-22'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-16'</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: black; ">5</span><span style="color: silver; ">,</span><span style="color: red; ">N'2013-01-17'</span><span style="color: maroon; ">)</span><span style="color: silver; ">;</span>
<br/><span style="color: maroon; ">go</span><span style="color: blue; ">with</span>&nbsp;<span style="color: maroon; ">[get_latest]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[id]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">cast</span><span style="color: maroon; ">(</span><span style="color: maroon; ">[color]</span>&nbsp;<span style="color: blue; ">as</span>&nbsp;<span style="color: black; font-style: italic; ">date</span><span style="color: maroon; ">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">as</span>
<br/><span style="color: maroon; ">[[color]]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;row_number()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;over&nbsp;(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partition&nbsp;by&nbsp;[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">order</span>&nbsp;<span style="color: blue; ">by</span>&nbsp;<span style="color: maroon; ">[color]</span>&nbsp;<span style="color: blue; ">desc</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: maroon; ">as</span>&nbsp;<span style="color: maroon; ">[row_number]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">from</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">##flower</span><span style="color: maroon; ">)</span>
<br/><span style="color: blue; ">select</span>&nbsp;<span style="color: maroon; ">[id]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[flower]</span>
<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[[color]]from&nbsp;&nbsp;&nbsp;[get_latest]</span>
<br/><span style="color: blue; ">where</span>&nbsp;&nbsp;<span style="color: maroon; ">[row_number]</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: black; ">1</span><span style="color: silver; ">;</span>&nbsp;
</span></div>


			  
			  </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
</html>
